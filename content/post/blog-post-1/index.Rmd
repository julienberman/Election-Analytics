---
title: 'Blog Post 1: Historical Election Data'
author: Julien Berman
date: '2024-09-05'
slug: blog-post-1
categories: []
tags: []
---
```{r}
# Load libraries.
## install via `install.packages("name")`
library(ggplot2)
library(maps)
library(tidyverse)
```
In this first blog post, I will analyze and visualize historical presidential election data in order to better understand trends in the electoral college and develop a naive predictive model for the 2024 election. I will complete extensions 1 and 3 as well as some exploratory analysis of my own.

# Electoral College Timeline

Below I have produced two electoral college maps for the previous presidential elections from 1948 to 2020. The following interactive map plots the electoral college results at the state level:
```{r}

```


```{r}
# Read presidential popular vote. 
d_popvote <- read_csv("data/popvote_1948-2020.csv")

# Subset data to most recent past election year. 
d_popvote |> 
  filter(year == 2020) |> 
  select(party, candidate, pv2p)

# Pivot data to wide format with party names as columns and two-party vote share as values.
(d_popvote_wide <- d_popvote |>
    select(year, party, pv2p) |>
    pivot_wider(names_from = party, values_from = pv2p))

# Modify winner column to show "D" if Democrats win and "R" if Republicans win. 
(d_popvote_wide <- d_popvote_wide |> 
    mutate(winner = case_when(democrat > republican ~ "D",
                              TRUE ~ "R")))

# Summarize data with respect to winners. 
d_popvote_wide |> 
  group_by(winner) |>
  summarise(races = n())

####----------------------------------------------------------#
#### Visualize trends in national presidential popular vote. 
####----------------------------------------------------------#

# Visualize the two-party presidential popular over time. 
# TODO

####----------------------------------------------------------#
#### State-by-state map of presidential popular votes.
####----------------------------------------------------------#

# Sequester shapefile of states from `maps` library.
states_map <- map_data("state")

# Read wide version of dataset that can be used to compare candidate votes with one another. 
d_pvstate_wide <- read_csv("data/clean_wide_state_2pv_1948_2020.csv")

# Merge d_pvstate_wide with state_map.
d_pvstate_wide$region <- tolower(d_pvstate_wide$state)

pv_map <- d_pvstate_wide |>
  filter(year == 2020) |>
  left_join(states_map, by = "region")

# Make map grid of state winners for each election year available in the dataset. 

# 2020 alone
pv_map %>% 
  mutate(winner = ifelse(D_pv > R_pv2p, "d", "r")) %>% 
  ggplot(aes(long, lat, group = group)) +
  geom_polygon(aes(fill = winner)) +
  scale_fill_manual(values = c("dodgerblue4", "red")) +
  theme_void()

# all years, with scroller
d_pvstate_wide %>% 
  filter(year >= 1980) %>% 
  left_join(states_map, by = "region") %>% 
  mutate(winner = ifelse(D_pv > R_pv2p, "d", "r")) %>% 
  ggplot(aes(long, lat, group = group)) +
  facet_wrap(facets = year ~.) +
  geom_polygon(aes(fill = winner), color = 'white') +
  scale_fill_manual(values = c("dodgerblue4", "red")) +
  theme_void() +
  ggtitle("Presidential Vote Share (1980-2020)") +
  theme(strip.text = element_text(size = 12), aspect.ratio = 1)
  
####----------------------------------------------------------#
#### Forecast: simplified electoral cycle model. 
####----------------------------------------------------------#

# Create prediction (pv2p and margin) based on simplified electoral cycle model: 
# vote_2024 = 3/4*vote_2020 + 1/4*vote_2016 (lag1, lag2, respectively). 
pred_2024 <- d_pvstate_wide %>% 
  filter(year == 2020) %>% 
  left_join(states_map, by = "region") %>%
  mutate(
    d_vote_2024 = 3/4 * D_pv2p + 1/4*  D_pv2p_lag1,
    r_vote_2024 = 3/4 * R_pv2p + 1/4*  R_pv2p_lag1,
    winner_2024 = ifelse(d_vote_2024 > r_vote_2024, "d", "r"),
    margin_2024 = d_vote_2024 - r_vote_2024)

# plot who wins
pred_2024 %>% 
  ggplot(aes(long, lat, group = group)) +
  geom_polygon(aes(fill = winner_2024)) +
  scale_fill_manual(values = c("dodgerblue4", "red")) +
  theme_void()

# plot margins
pred_2024 %>% 
  ggplot(aes(long, lat, group = group)) +
  geom_polygon(aes(fill = margin_2024, color = "black")) +
  scale_fill_gradient2(
   high = "dodgerblue4",
   low = "red",
   mid = "white",
   name = "win margin",
   breaks = c(-50, -25, 0, 25, 50),
   limits = c(-50, 50)) +
  theme_void()
```